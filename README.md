# ğŸ“š Librarian API

A Rails 8 API-only project for managing a library system with custom authentication (similar to OAuth).  

---

## âš™ï¸ Requirements

- **Ruby** 3.4.4  
- **Rails** 8.0.2  
- **PostgreSQL**  

---

## ğŸš€ Setup

1. Clone the repository:  
   ```bash
   git clone <repo_url>
   cd librarian-api
   ```
2. Install dependencies:  
   ```bash
   bundle install
   ```
3. Setup the database:  
   ```bash
   rails db:create db:migrate
   ```
4. Seed initial data:  
   ```bash
   rails db:seed
   ```
5. Start server:  
   ```bash
   rails server 
   ```
---

## ğŸ”‘ Authentication

This API uses a **custom token-based authentication system** (not Devise or any library).  
It works similarly to OAuth, requiring both a **Client Token** and an **Access Token**.  

- **Client Token** â†’ Identifies and whitelists external apps.  
- **Access Token** â†’ Authenticates users and determines their role/last login.  

### Authorization Header

#### Authenticated User
```http
Authorization: Bearer api_key={client_id}:{client_key}, access_token={user_id}:{access_token}
```

#### Non-Authenticated User (public endpoints: `login` & `register`)
```http
Authorization: Bearer api_key={client_id}:{client_key}
```

ğŸ‘‰ Already implemented in the [Vue Client](https://github.com/renzodiaz/library-management-vue).

---

#### Get the API KEY

Enter to your rails consolo and get the first ApiKey generated by seeds and copy the id and key

```
ApiKey.first
```

## ğŸ“¡ API Endpoints

### ğŸ“– Books
**(CRUD available only to Librarians)**

- Get all books  
  ```http
  GET /api/v1/books
  ```
- Get a specific book  
  ```http
  GET /api/v1/books/:id
  ```
- Create a book  
  ```http
  POST /api/v1/books
  {
    "data": {
      "title": "String",
      "genre": "String",
      "total_copies": Integer,
      "author": "Author"
    }
  }
  ```
- Update a book (partial updates with PATCH)  
  ```http
  PATCH /api/v1/books/:id
  {
    "data": {
      "title": "String",
      "genre": "String",
      "total_copies": Integer,
      "author": "Author"
    }
  }
  ```
- Delete a book  
  ```http
  DELETE /api/v1/books/:id
  ```

---

### ğŸ“š Borrowings
**(Members can borrow; Librarians can return)**

- Get all borrowings  
  ```http
  GET /api/v1/borrowings
  ```
- Get specific borrowing  
  ```http
  GET /api/v1/borrowings/:id
  ```
- Create a borrowing  
  ```http
  POST /api/v1/borrowings
  {
    "data": {
      "user": "User",
      "book": "Book"
    }
  }
  ```
- Update borrowing  
  ```http
  PATCH /api/v1/borrowings/:id
  {
    "data": {
      "user": "User",
      "book": "Book"
    }
  }
  ```
- Return a book  
  ```http
  POST /api/v1/borrowings/:id
  ```

---

### ğŸ” Search
Uses **PG Search (PostgreSQL FTS)** across multiple models.  

```http
GET /api/v1/search/:text
```

